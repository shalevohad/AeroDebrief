<Window x:Class="ShalevOhad.DCS.SRS.Recorder.PlayerClient.UI.MainWindow"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
xmlns:local="clr-namespace:ShalevOhad.DCS.SRS.Recorder.PlayerClient.UI"
xmlns:controls="clr-namespace:ShalevOhad.DCS.SRS.Recorder.PlayerClient.UI.Controls"
Title="{Binding WindowTitle, FallbackValue='SRS Signal Analyzer'}" 
Height="900" 
Width="1400"
MinHeight="600"
MinWidth="1000"
Background="{StaticResource PrimaryBackgroundBrush}"
WindowStartupLocation="CenterScreen">
    
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header Section -->
        <Border Grid.Row="0" Style="{StaticResource ModernCard}" Margin="0,0,0,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Vertical">
                    <TextBlock Style="{StaticResource HeaderTextStyle}" Text="SRS Signal Analyzer"/>
                    
                    <!-- Current File Name -->
                    <TextBlock Style="{StaticResource BodyTextStyle}" 
                             Text="{Binding CurrentFileName, FallbackValue=''}"
                             FontWeight="SemiBold"
                             Foreground="{StaticResource AccentBrush}"
                             Margin="0,2,0,0"
                             Visibility="{Binding IsFileLoaded, Converter={StaticResource BoolToVisibilityConverter}}"/>
                    
                    <!-- Status Text -->
                    <TextBlock Style="{StaticResource BodyTextStyle}" 
                             Text="{Binding StatusText, FallbackValue='Ready to load recording file'}"
                             Margin="0,4,0,0"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Style="{StaticResource ModernSecondaryButton}" 
                          Content="Load File" 
                          Click="LoadFileButton_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*" MinWidth="400"/>
                <ColumnDefinition Width="8"/>
                <ColumnDefinition Width="1*" MinWidth="300"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel: Waveform and Spectrum -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="2*" MinHeight="200"/>
                    <RowDefinition Height="8"/>
                    <RowDefinition Height="1*" MinHeight="150"/>
                </Grid.RowDefinitions>

                <!-- Waveform Viewer -->
                <Border Grid.Row="0" Style="{StaticResource ModernCard}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Header with Title -->
                        <TextBlock Grid.Row="0" Style="{StaticResource SubHeaderTextStyle}" Text="Waveform Viewer"/>
                        
                        <!-- Zoom Controls Toolbar -->
                        <Border Grid.Row="1" Background="{StaticResource SecondaryBackgroundBrush}" 
                                Padding="8,4" Margin="0,8,0,0" CornerRadius="4">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Zoom Control Buttons -->
                                <StackPanel Grid.Column="0" Orientation="Horizontal">
                                    <Button Style="{StaticResource ModernSecondaryButton}" 
                                          Content="Zoom In" 
                                          Click="WaveformZoomIn_Click"
                                          ToolTip="Hold Ctrl and drag to select region, or click to zoom in at center"
                                          FontSize="11"
                                          Padding="8,4"
                                          Margin="0,0,4,0"/>
                                    <Button Style="{StaticResource ModernSecondaryButton}" 
                                          Content="Zoom Out" 
                                          Click="WaveformZoomOut_Click"
                                          ToolTip="Zoom out one step"
                                          FontSize="11"
                                          Padding="8,4"
                                          Margin="0,0,4,0"/>
                                    <Button Style="{StaticResource ModernSecondaryButton}" 
                                          Content="Reset View" 
                                          Click="WaveformZoomReset_Click"
                                          ToolTip="Reset to full view"
                                          FontSize="11"
                                          Padding="8,4"
                                          Margin="0,0,8,0"/>
                                    
                                    <CheckBox Content="Sync with Spectrum" 
                                            IsChecked="{Binding SyncSpectrumWithWaveform}"
                                            VerticalAlignment="Center"
                                            FontSize="11"
                                            Foreground="{StaticResource TextPrimaryBrush}"/>
                                </StackPanel>

                                <!-- Instruction Text -->
                                <TextBlock Grid.Column="1" 
                                         Text="Tip: Hold Ctrl and drag to select zoom region | Click to seek"
                                         FontSize="10"
                                         FontStyle="Italic"
                                         Foreground="{StaticResource TextSecondaryBrush}"
                                         VerticalAlignment="Center"
                                         HorizontalAlignment="Center"/>
                            </Grid>
                        </Border>

                        <!-- Main Waveform Display with MiniMap -->
                        <controls:WaveformWithMiniMap Grid.Row="2" 
                                                    x:Name="WaveformWithMiniMap"
                                                    WaveformData="{Binding WaveformData}"
                                                    FrequencyWaveforms="{Binding FrequencyWaveforms}"
                                                    PlayheadPosition="{Binding PlayheadPosition}"
                                                    ZoomStartTime="{Binding ZoomStartTime}"
                                                    ZoomEndTime="{Binding ZoomEndTime}"
                                                    TotalDuration="{Binding TotalTime}"
                                                    IsLoading="{Binding IsWaveformLoading}"
                                                    LoadingMessage="{Binding WaveformLoadingMessage}"
                                                    IsInteractive="True"
                                                    ShowMiniMap="True"
                                                    MiniMapHeight="60"
                                                    SeekRequested="WaveformViewer_SeekRequested"
                                                    ZoomRegionSelected="WaveformViewer_ZoomRegionSelected"
                                                    MinimapClicked="WaveformMiniMap_Clicked"
                                                    MinimapDragged="WaveformMiniMap_Dragged"
                                                    Margin="0,8,0,0"
                                                    ToolTip="Click to seek | Hold Ctrl and drag to zoom | Use minimap to navigate"/>
                        
                        <!-- Time Range Display -->
                        <Border Grid.Row="3" Background="{StaticResource SecondaryBackgroundBrush}" 
                                Padding="8,4" Margin="0,4,0,0" CornerRadius="4">
                            <TextBlock Text="{Binding TimeRangeDisplay}" 
                                     FontSize="11"
                                     FontFamily="Consolas"
                                     Foreground="{StaticResource TextPrimaryBrush}"
                                     HorizontalAlignment="Center"/>
                        </Border>
                    </Grid>
                </Border>

                <GridSplitter Grid.Row="1" 
                            HorizontalAlignment="Stretch" 
                            VerticalAlignment="Center"
                            Background="{StaticResource BorderBrush}"
                            Height="2"/>

                <!-- Spectral Analyzer -->
                <Border Grid.Row="2" Style="{StaticResource ModernCard}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Style="{StaticResource SubHeaderTextStyle}" Text="Spectral Analyzer"/>
                        
                        <controls:SpectrumAnalyzer Grid.Row="1" 
                                                 x:Name="SpectrumAnalyzer"
                                                 SpectrumData="{Binding SpectrumData}"
                                                 Background="White"
                                                 Margin="0,8,0,0"/>
                    </Grid>
                </Border>
            </Grid>

            <GridSplitter Grid.Column="1" 
                        HorizontalAlignment="Center" 
                        VerticalAlignment="Stretch"
                        Background="{StaticResource BorderBrush}"
                        Width="2"/>

            <!-- Right Panel: Frequency Tree and Mixer -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="1*" MinHeight="200"/>
                    <RowDefinition Height="8"/>
                    <RowDefinition Height="1*" MinHeight="200"/>
                </Grid.RowDefinitions>

                <!-- Frequency Tree -->
                <Border Grid.Row="0" Style="{StaticResource ModernCard}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Grid Grid.Row="0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <TextBlock Grid.Column="0" Style="{StaticResource SubHeaderTextStyle}" Text="Frequencies"/>
                            
                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <Button Style="{StaticResource ModernSecondaryButton}" 
                                      Content="All" 
                                      Click="SelectAllFrequencies_Click"
                                      FontSize="10"
                                      Padding="8,4"
                                      Margin="0,0,4,0"/>
                                <Button Style="{StaticResource ModernSecondaryButton}" 
                                      Content="None" 
                                      Click="SelectNoFrequencies_Click"
                                      FontSize="10"
                                      Padding="8,4"/>
                            </StackPanel>
                        </Grid>

                        <controls:FrequencyTreeView Grid.Row="1" 
                                                  x:Name="FrequencyTreeView"
                                                  Frequencies="{Binding AvailableFrequencies}"
                                                  FrequencySelectionChanged="FrequencyTreeView_SelectionChanged"
                                                  Margin="0,8,0,0"/>
                    </Grid>
                </Border>

                <GridSplitter Grid.Row="1" 
                            HorizontalAlignment="Stretch" 
                            VerticalAlignment="Center"
                            Background="{StaticResource BorderBrush}"
                            Height="2"/>

                <!-- Frequency Mixer -->
                <Border Grid.Row="2" Style="{StaticResource ModernCard}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Style="{StaticResource SubHeaderTextStyle}" Text="Frequency Mixer"/>
                        
                        <controls:FrequencyMixer Grid.Row="1" 
                                               x:Name="FrequencyMixer"
                                               ActiveFrequencies="{Binding ActiveFrequencies}"
                                               GainChanged="FrequencyMixer_GainChanged"
                                               PanChanged="FrequencyMixer_PanChanged"
                                               Margin="0,8,0,0"/>
                    </Grid>
                </Border>
            </Grid>
        </Grid>

        <!-- Transport Controls -->
        <Border Grid.Row="2" Style="{StaticResource ModernCard}" Margin="0,16,0,0">
            <controls:TransportControls x:Name="TransportControls"
                                      IsPlaying="{Binding IsPlaying}"
                                      IsPaused="{Binding IsPaused}"
                                      CurrentTime="{Binding CurrentTime}"
                                      TotalTime="{Binding TotalTime}"
                                      Progress="{Binding Progress}"
                                      PlayRequested="TransportControls_PlayRequested"
                                      PauseRequested="TransportControls_PauseRequested"
                                      StopRequested="TransportControls_StopRequested"
                                      SeekRequested="TransportControls_SeekRequested"/>
        </Border>
    </Grid>
</Window>